<div class="text-analyzer">
  <h2>Text Analyzer</h2>

  <div class="input-section">
    <mat-form-field appearance="fill">
      <mat-label>Enter text</mat-label>
      <textarea
        matInput
        cdkTextareaAutosize
        #autosize="cdkTextareaAutosize"
        cdkAutosizeMinRows="3"
        cdkAutosizeMaxRows="10"
        [formControl]="inputControl"
        (input)="onInputChange($event)"
        placeholder="Type something... the prediction will update automatically"
      ></textarea>
      <mat-hint align="end" *ngIf="isLoadingPrediction">Predicting...</mat-hint>
    </mat-form-field>
  </div>

  <div class="button-section">
    <button
      mat-raised-button
      color="primary"
      (click)="analyzeTextAttention()"
      [disabled]="isLoadingAttention || !inputControl.value?.trim()"
    >
      <mat-icon *ngIf="isLoadingAttention">
        <mat-spinner diameter="20"></mat-spinner>
      </mat-icon>
      {{ isLoadingAttention ? "Analyzing..." : "Analyze Attention" }}
    </button>
  </div>

  <div *ngIf="errorMessage" class="error-section">
    <p>Error: {{ errorMessage }}</p>
  </div>

  <div *ngIf="predictedWord && !isLoadingPrediction" class="prediction-section">
    <h3>Next Word Prediction:</h3>
    <p>
      <strong>{{ predictedWord }}</strong>
    </p>
  </div>

  <div
    *ngIf="attentionTokens.length > 0 && !isLoadingAttention"
    class="attention-section"
  >
    <h3>Attention Analysis:</h3>

    <h4>Tokens:</h4>
    <div class="tokens-display">
      <pre>{{ attentionTokens | json }}</pre>
    </div>

    <h4>Attention Matrix:</h4>
    <div class="attention-matrix">
      <div
        *ngFor="let row of attentionMatrix; let i = index"
        class="matrix-row"
      >
        <span class="token-label">{{ attentionTokens[i] }}</span>
        <span
          *ngFor="let score of row; let j = index"
          class="attention-score"
          [class.high-attention]="score > 0.1"
          [class.medium-attention]="score > 0.05 && score <= 0.1"
          [class.low-attention]="score <= 0.05"
          [title]="
            'Attention from ' +
            attentionTokens[i] +
            ' to ' +
            attentionTokens[j] +
            ': ' +
            (score | number: '1.4-4')
          "
        >
          {{ score | number: "1.2-4" }}
        </span>
      </div>
    </div>
  </div>
</div>
