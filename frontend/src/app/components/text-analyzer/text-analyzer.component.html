<div class="text-analyzer">
  <h2>Text Analyzer</h2>

  <div>
    <textarea
      [(ngModel)]="inputText"
      rows="4"
      cols="50"
      placeholder="Enter text here..."
    ></textarea>
  </div>

  <div style="margin-top: 10px">
    <button
      (click)="predictNextWord()"
      [disabled]="isLoadingPrediction || !inputText.trim()"
    >
      {{ isLoadingPrediction ? "Predicting..." : "Predict Next Word" }}
    </button>

    <button
      (click)="analyzeTextAttention()"
      [disabled]="isLoadingAttention || !inputText.trim()"
      style="margin-left: 10px"
    >
      {{ isLoadingAttention ? "Analyzing Attention..." : "Analyze Attention" }}
    </button>
  </div>

  <div *ngIf="errorMessage" style="color: red; margin-top: 10px">
    <p><strong>Error:</strong> {{ errorMessage }}</p>
  </div>

  <div *ngIf="predictedWord" style="margin-top: 20px">
    <h3>Next Word Prediction:</h3>
    <p>
      <strong>{{ predictedWord }}</strong>
    </p>
  </div>

  <div *ngIf="attentionTokens.length > 0" style="margin-top: 20px">
    <h3>Attention Analysis:</h3>

    <h4>Tokens:</h4>
    <pre>{{ attentionTokens | json }}</pre>

    <h4>Attention Matrix (Raw):</h4>
    <p>
      Rows: Attending From (Token Index), Columns: Attending To (Token Index)
    </p>

    <div
      *ngFor="let row of attentionMatrix; let i = index"
      style="display: flex; margin-bottom: 2px"
    >
      <span style="font-weight: bold; width: 100px; display: inline-block">
        {{ attentionTokens[i] }}:
      </span>

      <span
        *ngFor="let score of row; let j = index"
        style="
          margin-right: 5px;
          padding: 2px;
          border: 1px solid #eee;
          min-width: 50px;
          text-align: right;
        "
      >
        {{ score | number: "1.2-4" }}
      </span>
    </div>

    <pre *ngIf="attentionMatrix.length === 0">
      {{ attentionMatrix | json }}
    </pre>
  </div>
</div>
